Version 4.1
SHEET 1 3068 680
WIRE 1408 -336 1056 -336
WIRE 1488 -336 1408 -336
WIRE 944 -320 832 -320
WIRE 832 -304 832 -320
WIRE 1488 -304 1488 -336
WIRE 944 -272 944 -320
WIRE 768 -224 704 -224
WIRE 1520 -224 1488 -224
WIRE 1536 -224 1520 -224
WIRE 704 -192 704 -224
WIRE 1056 -176 1056 -208
WIRE 1056 -176 928 -176
WIRE 768 -128 768 -224
WIRE 832 -128 768 -128
WIRE 1056 -64 1056 -176
WIRE 1104 -64 1056 -64
WIRE 1296 -64 1184 -64
WIRE 928 -48 928 -80
WIRE 1296 -32 1296 -64
WIRE 1408 -32 1408 -336
WIRE 1408 -32 1296 -32
WIRE 1296 -16 1296 -32
WIRE 1296 0 1296 -16
WIRE 640 16 624 16
WIRE 736 16 640 16
WIRE 784 16 736 16
WIRE 944 16 848 16
WIRE 1056 16 1056 -64
WIRE 1056 16 944 16
WIRE 1184 16 1056 16
WIRE 1184 48 1184 16
WIRE 640 80 640 16
WIRE 1296 112 1296 80
WIRE 736 176 736 16
WIRE 864 176 736 176
WIRE 1200 176 944 176
WIRE 640 192 640 160
WIRE 1296 224 1296 112
WIRE 1296 224 1280 224
WIRE 1344 224 1296 224
WIRE 1200 320 1200 272
FLAG 640 192 0
FLAG 1408 48 0
FLAG 1344 304 0
FLAG 944 16 PortD3
FLAG 624 16 Vc11
IOPIN 624 16 Out
FLAG 832 -224 0
FLAG 1200 320 0
FLAG 1536 -144 0
FLAG 1520 -224 HalfVdd
FLAG 704 -112 0
FLAG 928 -48 0
SYMBOL res 624 64 R0
SYMATTR InstName R11
SYMATTR Value 3.3e6
SYMBOL diode 848 0 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 35 15 VTop 2
SYMATTR InstName D12
SYMATTR Value Drb751v40t1g
SYMBOL voltage 1408 -48 R0
WINDOW 123 0 0 Left 0
WINDOW 3 -38 56 Invisible 2
SYMATTR Value PWL(0 0 .0001 {VDD})
SYMATTR SpiceLine Rser=1 Cpar=1e-5
SYMATTR InstName V3
SYMBOL res 1328 208 R0
SYMATTR InstName R13
SYMATTR Value 1e6
SYMBOL voltage 832 -320 R0
WINDOW 3 24 44 Left 2
SYMATTR Value PWL TIME_SCALE_FACTOR={PWM_HALF_PERIOD} VALUE_SCALE_FACTOR={VDD} (2 1) REPEAT FOR 3 REPEAT FOR 3  (0 1 .9 1 1 0 1.9 0 2 1 4 1) ENDREPEAT  (+0 1 +8 1) ENDREPEAT
SYMATTR SpiceLine Rser=10 Cpar=1E-7
SYMATTR InstName V4
SYMBOL res 960 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 10000
SYMBOL DMN67D8L 1248 224 R0
WINDOW 3 -78 -21 Top 2
SYMATTR InstName Q13
SYMBOL DMP2305U 1008 -272 R180
WINDOW 3 -80 -21 Top 2
SYMATTR InstName U3
SYMBOL DMP1045U 1248 48 R180
WINDOW 3 -60 -20 Top 2
SYMATTR InstName Q12
SYMBOL res 1472 -320 R0
WINDOW 3 -61 52 Left 2
SYMATTR Value 1e6
SYMATTR InstName R1
SYMBOL res 1520 -240 R0
WINDOW 3 -64 62 Left 2
SYMATTR Value 1e6
SYMATTR InstName R2
SYMBOL res 1200 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 3.3e6
SYMBOL voltage 704 -208 R0
WINDOW 3 24 44 Left 2
SYMATTR Value PWL TIME_SCALE_FACTOR={PWM_HALF_PERIOD} VALUE_SCALE_FACTOR={VDD} REPEAT FOR 3 REPEAT FOR 3  (0 0 .9 0 1 1 1.9 1 2 0 4 0) ENDREPEAT (+0 0 +8 0) ENDREPEAT
SYMATTR SpiceLine Rser=10 Cpar=1E-7
SYMATTR InstName V1
SYMBOL DMN67D8L 880 -128 M0
WINDOW 3 -78 -21 Top 2
SYMATTR InstName Q1
TEXT -184 384 Left 2 !.tran 0 .1 0 .0005
TEXT 496 352 Left 5 ;Battery Extender Circuit
TEXT 640 -416 Left 2 ;Port D3 on Arduino is simulated by this V4+U3. Neither is on PCB.
TEXT 640 -360 Left 2 ;Software holds port D3 at +Vdd during V1's PWM, then switches to INPUT
TEXT 1312 104 Left 2 ;P channel MOSFETS: Q12: 1V threshold or lower, \n    Q10: 2V threshold
TEXT 1312 192 Left 2 ;N channel MOSFETS 2.5V threshold or lower
TEXT -184 408 Left 2 !.include "RB751V40T1G.LIB.txt"
TEXT -184 432 Left 2 !.param VDD=3.3 PWM_CYCLES=8 PWM_HALF_PERIOD=.001
TEXT 1344 -64 Left 2 ;Vdd
RECTANGLE Normal 1712 -112 624 -448 2
