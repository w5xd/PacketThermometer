Version 4.1
SHEET 1 2096 680
WIRE 1408 -336 1056 -336
WIRE 1488 -336 1408 -336
WIRE 944 -320 832 -320
WIRE 832 -304 832 -320
WIRE 1488 -304 1488 -336
WIRE 944 -272 944 -320
WIRE 1520 -224 1488 -224
WIRE 1536 -224 1520 -224
WIRE -144 -80 -160 -80
WIRE -32 -80 -144 -80
WIRE 336 -80 -32 -80
WIRE 1056 -64 1056 -208
WIRE 1104 -64 1056 -64
WIRE 1296 -64 1184 -64
WIRE -160 -48 -160 -80
WIRE 1296 -32 1296 -64
WIRE 1408 -32 1408 -336
WIRE 1408 -32 1296 -32
WIRE 1296 -16 1296 -32
WIRE 1296 0 1296 -16
WIRE 208 16 16 16
WIRE 336 16 336 -16
WIRE 448 16 336 16
WIRE 544 16 512 16
WIRE 624 16 544 16
WIRE 640 16 624 16
WIRE 736 16 640 16
WIRE 784 16 736 16
WIRE 944 16 848 16
WIRE 1056 16 1056 -64
WIRE 1056 16 944 16
WIRE 1184 16 1056 16
WIRE 16 48 16 16
WIRE 1184 48 1184 16
WIRE -160 64 -160 32
WIRE 544 64 544 16
WIRE 208 80 208 16
WIRE 640 80 640 16
WIRE 208 112 208 80
WIRE 1296 112 1296 80
WIRE 336 128 336 16
WIRE 16 160 16 128
WIRE 544 176 544 128
WIRE 640 176 640 160
WIRE 640 176 544 176
WIRE 736 176 736 16
WIRE 864 176 736 176
WIRE 1200 176 944 176
WIRE 336 192 336 176
WIRE 640 192 640 176
WIRE 208 224 208 208
WIRE 240 224 208 224
WIRE 336 224 336 192
WIRE 336 224 320 224
WIRE 1296 224 1296 112
WIRE 1296 224 1280 224
WIRE 1344 224 1296 224
WIRE 336 272 336 224
WIRE -32 320 -32 -80
WIRE 96 320 96 144
WIRE 96 320 -32 320
WIRE 240 320 96 320
WIRE 1200 320 1200 272
WIRE 336 384 336 368
FLAG 336 384 0
FLAG -160 64 0
FLAG 16 160 0
FLAG 640 192 0
FLAG 1408 48 0
FLAG 1344 304 0
FLAG -144 -80 VCharge
IOPIN -144 -80 Out
FLAG 944 16 PortD3
FLAG 624 16 Vc11
IOPIN 624 16 Out
FLAG 832 -224 0
FLAG 1200 320 0
FLAG 1536 -144 0
FLAG 1520 -224 HalfVdd
SYMBOL diode 320 -80 R0
WINDOW 0 46 10 Left 2
WINDOW 3 -178 35 Left 2
SYMATTR InstName D10
SYMATTR Value Drb751v40t1g
SYMBOL voltage -160 -64 R0
WINDOW 3 24 44 Invisible 2
SYMATTR Value PWL REPEAT FOR {PWM_CYCLES} (0 0 {{PWM_HALF_PERIOD}-.0001} 0 {PWM_HALF_PERIOD} {VDD} {2 * {PWM_HALF_PERIOD}-.0001} {VDD} {2*PWM_HALF_PERIOD} 0) ENDREPEAT
SYMATTR SpiceLine Rser=1 cPar=1e-5
SYMATTR InstName V1
SYMBOL voltage 16 32 R0
WINDOW 123 0 0 Left 0
WINDOW 39 -34 161 Left 2
WINDOW 3 -38 56 Left 2
SYMATTR SpiceLine Rser=1
SYMATTR Value {VDD}
SYMATTR InstName V2
SYMBOL res 624 64 R0
SYMATTR InstName R11
SYMATTR Value 3.3e6
SYMBOL diode 848 0 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 35 15 VTop 2
SYMATTR InstName D12
SYMATTR Value Drb751v40t1g
SYMBOL voltage 1408 -48 R0
WINDOW 123 0 0 Left 0
WINDOW 3 -38 56 Invisible 2
SYMATTR Value PWL(0 0 .0001 {VDD})
SYMATTR SpiceLine Rser=1 Cpar=1e-5
SYMATTR InstName V3
SYMBOL res 1328 208 R0
SYMATTR InstName R13
SYMATTR Value 1e6
SYMBOL res 224 240 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 15 3 VBottom 2
SYMATTR InstName R10
SYMATTR Value 330
SYMBOL cap 528 64 R0
SYMATTR InstName C11
SYMATTR Value 10µ
SYMATTR SpiceLine V=16 Irms=11 Rser=0.00378043 Lser=0 mfg="KEMET" pn="C0805C106K4PAC" type="X5R"
SYMBOL diode 448 0 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 34 -5 VTop 2
SYMATTR InstName D11
SYMATTR Value Drb751v40t1g
SYMBOL voltage 832 -320 R0
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 0
SYMATTR Value PWL(0 {VDD} {PWM_HALF_PERIOD*.5} {VDD} {0.0001 + PWM_HALF_PERIOD*.5} 0 {2*PWM_HALF_PERIOD * PWM_CYCLES} 0 {.0004 + 2*PWM_HALF_PERIOD * PWM_CYCLES} {VDD})
SYMATTR SpiceLine Rser=10 Cpar=1E-5
SYMATTR InstName V4
SYMBOL res 960 160 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R12
SYMATTR Value 10000
SYMBOL DMN67D8L 1248 224 R0
WINDOW 3 -78 -21 Top 2
SYMATTR InstName Q13
SYMBOL DMN67D8L 288 320 M0
WINDOW 3 -76 -20 Top 2
SYMATTR InstName Q11
SYMBOL DMP2305U 1008 -272 R180
WINDOW 3 -80 -21 Top 2
SYMATTR InstName U3
SYMBOL DMP1045U 1248 48 R180
WINDOW 3 -60 -20 Top 2
SYMATTR InstName Q12
SYMBOL cap 320 128 R0
WINDOW 3 47 43 Left 2
SYMATTR Value 10µ
SYMATTR InstName C10
SYMATTR SpiceLine V=16 Irms=11 Rser=0.00378043 Lser=0 mfg="KEMET" pn="C0805C106K4PAC" type="X5R"
SYMBOL DMP3165L 160 144 R180
WINDOW 3 17 39 Top 2
SYMATTR InstName Q10
SYMBOL res 1472 -320 R0
WINDOW 3 -61 52 Left 2
SYMATTR Value 1e6
SYMATTR InstName R1
SYMBOL res 1520 -240 R0
WINDOW 3 -64 62 Left 2
SYMATTR Value 1e6
SYMATTR InstName R2
SYMBOL res 1200 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 3.3e6
TEXT -184 384 Left 2 !.tran 0 70 0 .0005
TEXT 496 352 Left 5 ;Battery Extender Circuit
TEXT 640 -416 Left 2 ;Port D3 on Arduino is simulated by this V4+U3. Neither is on PCB.
TEXT 640 -360 Left 2 ;Software holds port D3 at +Vdd during V1's PWM, then switches to INPUT
TEXT -120 -144 Left 2 ;Port D4 runs 2msec PWM period for {PWM_CYCLES} cycles
TEXT 1312 104 Left 2 ;P channel MOSFETS: Q12: 1V threshold or lower, \n    Q10: 2V threshold
TEXT 1312 192 Left 2 ;N channel MOSFETS 2.5V threshold or lower
TEXT -120 -112 Left 2 ;and ends (sleeps) holding 0V
TEXT -184 408 Left 2 !.include "RB751V40T1G.LIB.txt"
TEXT -184 432 Left 2 !.param VDD=3.3 PWM_CYCLES=8 PWM_HALF_PERIOD=.001
TEXT 1344 -64 Left 2 ;Vdd
RECTANGLE Normal 1712 -112 624 -448 2
